> âš ï¸ **PARTIALLY OUTDATED** â€” This guide references PixiJS which has been replaced by Three.js. The game design concepts are still valid but rendering approach is different. See `docs/MASTER_PLAN.md` and `docs/FIX-STEPS/` for current implementation plan.

# LingoFriends Game Implementation Guide (for Cline) â€” PARTIALLY OUTDATED

**Purpose:** Step-by-step instructions to implement the game mechanics described in `GAME_DESIGN.md`. This replaces the current chat-first UX with a garden-first, activity-driven experience.

**Read first:** `GAME_DESIGN.md`, `.clinerules`, `CLAUDE_RULES.md`
**Prototype reference:** `docs/prototypes/prototype-v4-final.jsx`

---

## Overview of Changes

This is a **major UX overhaul** that touches most of the app. The current flow (login â†’ chat with AI â†’ occasional activities) becomes (login â†’ garden world â†’ pick a tree/path â†’ structured lessons with concrete activities).

### What stays
- Authentication (Pocketbase, `useAuth`)
- Pocketbase backend + all existing services
- AI service (Groq Llama 3.3) â€” prompt changes needed
- Voice services (TTS/STT) â€” used within lessons
- React + TypeScript + Vite + Tailwind foundation
- Existing UI component library (`components/ui/`)

### What changes fundamentally
- Navigation: Garden â†’ Path â†’ Lesson (replaces sidebar + chat)
- Activities: 6 types with penalty/retry mechanics (replaces 3 basic types)
- Rewards: Sun Drops + tree growth (replaces abstract XP)
- Home screen: Explorable garden world (replaces chat interface)
- AI output: Structured lesson plans (replaces conversational responses)

---

## Step 0: Dependencies

### Install PixiJS for garden rendering
```bash
npm install pixi.js @pixi/react
```

### Verify existing deps are current
```bash
# Already in package.json â€” no changes needed:
# framer-motion (for UI animations outside PixiJS)
# react, react-dom
# pocketbase
```

### Asset preparation
Before starting Phase B, download free sprite assets:
1. Go to [kenney.nl/assets](https://kenney.nl/assets)
2. Download: "Tiny Town" (tiles), "Animal Pack Redux" (characters), "Game Icons" (UI)
3. Place in `src/assets/sprites/`
4. For Phase A, continue using emoji/SVG placeholders (the prototype approach)

---

## Step 1: New Type Definitions

**File:** `src/types.ts` (modify existing)

### Add new enums and interfaces

```typescript
// Replace existing ActivityType enum
export enum ActivityType {
  MULTIPLE_CHOICE = 'multiple_choice',
  FILL_BLANK = 'fill_blank',
  WORD_ARRANGE = 'word_arrange',
  TRUE_FALSE = 'true_false',
  MATCHING = 'matching',
  TRANSLATE = 'translate',
  // Phase 2:
  // LISTEN_TYPE = 'listen_type',
  // SPEAK = 'speak',
}

// New: Structured activity data (replaces loose ActivityData)
export interface ActivityConfig {
  type: ActivityType;
  question?: string;
  options?: string[];
  correctIndex?: number;
  correctAnswer?: string;
  sentence?: string;        // For fill_blank â€” use ___ for the blank
  hint?: string;
  targetSentence?: string;  // For word_arrange
  scrambledWords?: string[];
  isTrue?: boolean;         // For true_false
  pairs?: Array<{ left: string; right: string }>;
  sourcePhrase?: string;    // For translate
  acceptedAnswers?: string[];
  sunDrops: number;         // 1-4
}

// New: A single step in a lesson
export interface LessonStep {
  tutorText: string;
  helpText: string;
  activity: ActivityConfig;
}

// New: Full lesson plan generated by AI
export interface LessonPlan {
  title: string;
  icon: string;
  steps: LessonStep[];
  totalSunDrops: number;
}

// New: Skill path definition
export interface SkillPath {
  id: string;
  name: string;
  icon: string;
  description: string;
  category: string;
  lessons: SkillPathLesson[];
}

export interface SkillPathLesson {
  id: string;
  title: string;
  icon: string;
  status: 'completed' | 'current' | 'locked';
  stars: number;            // 0-3
  sunDropsEarned: number;
  sunDropsMax: number;
  completedDate?: string;   // ISO date
}

// New: User's tree instance in their garden
export interface UserTree {
  id: string;
  skillPathId: string;
  name: string;
  icon: string;
  status: 'seed' | 'growing' | 'bloomed';
  health: number;           // 0-100
  lastRefreshDate: string;
  sunDropsTotal: number;
  lessonsCompleted: number;
  lessonsTotal: number;
  position: { x: number; y: number };
  decorations: string[];
  giftsReceived: GiftItem[];
}

// New: Gift types
export type GiftType = 'water_drop' | 'sparkle' | 'seed' | 'ribbon' | 'golden_flower';

export interface GiftItem {
  type: GiftType;
  fromUser: string;
  appliedDate: string;
}

// New: Garden decoration placed by user
export interface GardenDecoration {
  id: string;
  itemType: string;
  position: { x: number; y: number };
}

// New: Avatar
export interface PlayerAvatar {
  id: string;
  emoji: string;  // Placeholder â€” will become sprite reference
  name: string;
}

// Modify existing UserProfile â€” add fields:
// avatar_id: string;
// totalSunDrops: number;
// seedsAvailable: number;
// gardenSize: number;
```

---

## Step 2: New Pocketbase Collections

**File:** `scripts/setup-pocketbase.cjs` (modify existing)

Add these collections to the setup script. Follow the existing pattern in the file.

### `skill_paths`
```javascript
{
  name: 'skill_paths',
  type: 'base',
  schema: [
    { name: 'name', type: 'text', required: true },
    { name: 'icon', type: 'text', required: true },
    { name: 'description', type: 'text' },
    { name: 'category', type: 'text' },
    { name: 'difficulty', type: 'select', options: { values: ['beginner', 'intermediate', 'advanced'] } },
    { name: 'lesson_count', type: 'number', min: 1, max: 10 },
    { name: 'lesson_definitions', type: 'json' }, // Array of {title, icon, topic}
  ]
}
```

### `user_trees`
```javascript
{
  name: 'user_trees',
  type: 'base',
  schema: [
    { name: 'user', type: 'relation', options: { collectionId: 'users' }, required: true },
    { name: 'skill_path', type: 'relation', options: { collectionId: 'skill_paths' }, required: true },
    { name: 'status', type: 'select', options: { values: ['seed', 'growing', 'bloomed'] } },
    { name: 'health', type: 'number', min: 0, max: 100 },
    { name: 'last_refresh_date', type: 'date' },
    { name: 'sun_drops_earned', type: 'number' },
    { name: 'lessons_completed', type: 'number' },
    { name: 'position_x', type: 'number' },
    { name: 'position_y', type: 'number' },
    { name: 'decorations', type: 'json' },
    { name: 'gifts_received', type: 'json' },
  ]
}
```

### `gifts`
```javascript
{
  name: 'gifts',
  type: 'base',
  schema: [
    { name: 'from_user', type: 'relation', options: { collectionId: 'users' }, required: true },
    { name: 'to_user', type: 'relation', options: { collectionId: 'users' }, required: true },
    { name: 'gift_type', type: 'select', options: { values: ['water_drop', 'sparkle', 'seed', 'ribbon', 'golden_flower'] } },
    { name: 'target_tree', type: 'relation', options: { collectionId: 'user_trees' } },
    { name: 'status', type: 'select', options: { values: ['pending', 'applied', 'expired'] } },
  ]
}
```

### `garden_items`
```javascript
{
  name: 'garden_items',
  type: 'base',
  schema: [
    { name: 'user', type: 'relation', options: { collectionId: 'users' }, required: true },
    { name: 'item_type', type: 'text', required: true },
    { name: 'position_x', type: 'number' },
    { name: 'position_y', type: 'number' },
    { name: 'item_data', type: 'json' },
  ]
}
```

### Modify `profiles` collection
Add new fields to existing profiles schema:
```javascript
{ name: 'avatar_id', type: 'text' },
{ name: 'total_sun_drops', type: 'number' },
{ name: 'seeds_available', type: 'number' },
{ name: 'garden_size', type: 'number' },  // How many plots unlocked
```

---

## Step 3: Sun Drop Service (replaces XP logic)

**File:** `src/services/sunDropService.ts` (new)

```typescript
/**
 * Sun Drop Service
 * Manages the Sun Drop currency â€” earning, spending, penalties.
 * Replaces the XP system throughout the app.
 */

const DAILY_CAP = 50;

export interface SunDropResult {
  earned: number;
  total: number;
  capped: boolean;
  treeGrowth: number; // 0-1 fraction of growth this drop caused
}

export function calculateEarned(
  baseValue: number,
  isRetry: boolean,
  usedHelp: boolean,
  wrongAttempts: number
): number {
  // Half value on retry or after help
  let earned = (isRetry || usedHelp) ? Math.ceil(baseValue / 2) : baseValue;
  // Subtract wrong attempts (floor 0)
  earned = Math.max(0, earned - wrongAttempts);
  return earned;
}

export function calculatePenalty(): number {
  // Always -1 per wrong answer
  return 1;
}

export function calculateTreeHealth(
  daysSinceRefresh: number,
  giftsApplied: number
): number {
  const buffer = giftsApplied * 10;
  const effectiveDays = Math.max(0, daysSinceRefresh - buffer);
  if (effectiveDays <= 2) return 100;
  if (effectiveDays <= 5) return 85;
  if (effectiveDays <= 10) return 60;
  if (effectiveDays <= 14) return 35;
  if (effectiveDays <= 21) return 15;
  return 5;
}

export function calculateStars(earned: number, max: number): number {
  const pct = max > 0 ? earned / max : 0;
  if (pct >= 0.9) return 3;
  if (pct >= 0.6) return 2;
  return 1;
}
```

---

## Step 4: New Component Structure

### File tree for new/modified components
```
src/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ garden/                    # NEW â€” Garden world
â”‚   â”‚   â”œâ”€â”€ GardenWorld.tsx        # PixiJS canvas + avatar movement
â”‚   â”‚   â”œâ”€â”€ GardenTree.tsx         # Tree sprite with health states
â”‚   â”‚   â”œâ”€â”€ GardenAvatar.tsx       # Player avatar sprite
â”‚   â”‚   â”œâ”€â”€ GardenDecoration.tsx   # Placeable decorations
â”‚   â”‚   â”œâ”€â”€ InteractionPanel.tsx   # Popup when near a tree
â”‚   â”‚   â””â”€â”€ MobileDpad.tsx         # Touch controls
â”‚   â”‚
â”‚   â”œâ”€â”€ path/                      # NEW â€” Skill path view
â”‚   â”‚   â”œâ”€â”€ PathView.tsx           # Winding trail layout
â”‚   â”‚   â”œâ”€â”€ LessonNode.tsx         # Individual node on path
â”‚   â”‚   â””â”€â”€ PathHeader.tsx         # Skill name + progress
â”‚   â”‚
â”‚   â”œâ”€â”€ lesson/                    # NEW â€” Lesson gameplay
â”‚   â”‚   â”œâ”€â”€ LessonView.tsx         # Main lesson container
â”‚   â”‚   â”œâ”€â”€ TutorBubble.tsx        # Professor Finch message
â”‚   â”‚   â”œâ”€â”€ HelpPanel.tsx          # Help chat panel
â”‚   â”‚   â”œâ”€â”€ LessonComplete.tsx     # End-of-lesson screen
â”‚   â”‚   â”œâ”€â”€ SunDropBurst.tsx       # Reward animation
â”‚   â”‚   â”œâ”€â”€ PenaltyBurst.tsx       # Wrong answer animation
â”‚   â”‚   â””â”€â”€ activities/            # Activity type components
â”‚   â”‚       â”œâ”€â”€ MultipleChoice.tsx
â”‚   â”‚       â”œâ”€â”€ FillBlank.tsx
â”‚   â”‚       â”œâ”€â”€ WordArrange.tsx
â”‚   â”‚       â”œâ”€â”€ TrueFalse.tsx
â”‚   â”‚       â”œâ”€â”€ MatchingPairs.tsx
â”‚   â”‚       â”œâ”€â”€ Translate.tsx
â”‚   â”‚       â””â”€â”€ ActivityRouter.tsx # Routes type â†’ component
â”‚   â”‚
â”‚   â”œâ”€â”€ social/                    # NEW â€” Gifts & friends
â”‚   â”‚   â”œâ”€â”€ GiftUnlock.tsx         # Gift earned animation
â”‚   â”‚   â”œâ”€â”€ SendGift.tsx           # Pick friend to send to
â”‚   â”‚   â””â”€â”€ FriendGifts.tsx        # Received gifts panel
â”‚   â”‚
â”‚   â”œâ”€â”€ shared/                    # NEW â€” Shared game UI
â”‚   â”‚   â”œâ”€â”€ SunDropIcon.tsx        # Custom SVG icon (normal/broken/glow)
â”‚   â”‚   â”œâ”€â”€ SunDropCounter.tsx     # Header counter
â”‚   â”‚   â”œâ”€â”€ MiniTree.tsx           # Small tree for path/UI
â”‚   â”‚   â”œâ”€â”€ HealthBar.tsx          # Tree health bar
â”‚   â”‚   â”œâ”€â”€ AvatarPicker.tsx       # Choose animal avatar
â”‚   â”‚   â””â”€â”€ AvatarBubble.tsx       # Avatar display circle
â”‚   â”‚
â”‚   â”œâ”€â”€ ui/                        # KEEP â€” existing UI components
â”‚   â”‚   â””â”€â”€ ... (Button, Card, etc.)
â”‚   â”‚
â”‚   â”œâ”€â”€ ActivityWidget.tsx         # DEPRECATE â†’ replaced by lesson/activities/
â”‚   â”œâ”€â”€ ChatInterface.tsx          # DEPRECATE â†’ replaced by LessonView
â”‚   â”œâ”€â”€ AuthScreen.tsx             # KEEP
â”‚   â””â”€â”€ ProfileSettings.tsx        # MODIFY â€” add avatar, Sun Drops display
â”‚
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useAuth.tsx                # KEEP
â”‚   â”œâ”€â”€ useSessions.tsx            # MODIFY â€” adapt for lesson-based sessions
â”‚   â”œâ”€â”€ useGarden.tsx              # NEW â€” garden state, tree CRUD
â”‚   â”œâ”€â”€ useSunDrops.tsx            # NEW â€” Sun Drop earning/spending
â”‚   â”œâ”€â”€ useLesson.tsx              # NEW â€” lesson state machine
â”‚   â””â”€â”€ useMessageHandler.ts       # DEPRECATE or heavily modify
â”‚
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ pocketbaseService.ts       # MODIFY â€” add tree/gift/garden methods
â”‚   â”œâ”€â”€ groqService.ts             # MODIFY â€” new structured output format
â”‚   â”œâ”€â”€ sunDropService.ts          # NEW (see Step 3)
â”‚   â””â”€â”€ lessonGenerator.ts         # NEW â€” AI lesson plan generation
â”‚
â”œâ”€â”€ App.tsx                        # MAJOR REWRITE â€” garden-first navigation
â””â”€â”€ types.ts                       # MODIFY (see Step 1)
```

---

## Step 5: App.tsx Navigation Rewrite

**File:** `src/App.tsx` (major rewrite)

The app currently has a sidebar + chat layout. Replace with:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Header Bar        â”‚  â† Avatar, Sun Drops, streak
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                          â”‚
â”‚      Active View         â”‚  â† Garden, Path, or Lesson
â”‚   (fullscreen content)   â”‚
â”‚                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸŒ³ Garden â”‚ ğŸ“– Path â”‚ğŸ‘¥â”‚  â† Tab bar (hidden during lessons)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

Navigation state machine:
```
Garden (home) â”€â”€â”€ tap tree â”€â”€â”€â†’ Path (sub-menu) â”€â”€â”€ tap lesson â”€â”€â”€â†’ Lesson (gameplay)
    â†‘                                â†‘                                    â”‚
    â””â”€â”€â”€â”€ back â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ back â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ complete/back â”€â”€â”€â”€â”€â”€â”€â”˜
```

Key rules:
- Garden is always the home view
- Path opens for a specific skill path (passed as prop)
- Lesson opens for a specific lesson within a path
- Tab bar is visible on Garden and Path, hidden during Lesson
- Header bar is always visible

---

## Step 6: AI Prompt Changes

**File:** `src/services/lessonGenerator.ts` (new)

The AI must generate **structured lesson plans**, not conversational responses.

### System Prompt (for lesson generation)

```
You are Professor Finch, a friendly bird who teaches languages to children.

Generate a structured lesson plan as JSON. Each lesson has 5-8 steps.
Each step has a brief tutorText (1-2 encouraging sentences in the target language context),
a helpText (hint for struggling students), and an activity.

Rules:
- Vary activity types â€” never more than 2 of the same type in a row
- tutorText is BRIEF (max 2 sentences) â€” it frames the activity, not a standalone conversation
- helpText gives a specific, targeted hint for that exact question
- sunDrops value: 1-2 for easy (true_false), 2-3 for medium (MC, fill_blank), 3-4 for hard (translate, matching)
- All content must be age-appropriate for the specified age group
- Questions progress from easy to hard within a lesson
- Use vocabulary from the skill path topic

Respond with ONLY valid JSON matching this schema:
{
  "title": "Lesson Title",
  "icon": "emoji",
  "steps": [
    {
      "tutorText": "string",
      "helpText": "string",
      "activity": {
        "type": "multiple_choice|fill_blank|word_arrange|true_false|matching|translate",
        "question": "string (for MC, TF)",
        "options": ["string"] (for MC, 4 items),
        "correctIndex": number (for MC),
        "correctAnswer": "string (for FB)",
        "sentence": "string with ___ (for FB)",
        "hint": "string",
        "targetSentence": "string (for WA)",
        "scrambledWords": ["string"] (for WA),
        "isTrue": boolean (for TF),
        "pairs": [{"left":"string","right":"string"}] (for matching, 4 pairs),
        "sourcePhrase": "string (for translate)",
        "acceptedAnswers": ["string"] (for translate, 2-3 variants),
        "sunDrops": number (1-4)
      }
    }
  ]
}
```

### Calling Pattern
```typescript
// In lessonGenerator.ts
export async function generateLessonPlan(
  skillPath: string,
  lessonTopic: string,
  targetLanguage: string,
  nativeLanguage: string,
  ageGroup: AgeGroup,
  level: CEFRLevel
): Promise<LessonPlan> {
  const prompt = `Generate a lesson about "${lessonTopic}" for the "${skillPath}" skill path.
    Target language: ${targetLanguage}. Native language: ${nativeLanguage}.
    Age group: ${ageGroup}. CEFR level: ${level}.`;

  const response = await groqService.generateCompletion(systemPrompt, prompt);
  const plan = JSON.parse(response);

  // Validate and calculate totals
  plan.totalSunDrops = plan.steps.reduce((s, step) => s + step.activity.sunDrops, 0);
  return plan;
}
```

### Refresher Lesson Generation
For spaced repetition refreshers, use a different prompt:
```
Generate a SHORT refresher lesson (3-4 activities only) reviewing vocabulary
from the "${skillPath}" path. Focus on words the student learned previously.
Use varied activity types. This is a review, not new content.
```

---

## Step 7: Implementation Order

### Phase A: Core Mechanics (do first)

**A1.** Update `types.ts` with all new types (Step 1)
**A2.** Create `sunDropService.ts` (Step 3)
**A3.** Build all 6 activity components in `components/lesson/activities/`
  - Start from the prototype code as reference
  - Each must support: help button, retry, penalty callback, half-reward on retry
**A4.** Build `LessonView.tsx` â€” the lesson gameplay container
  - Tutor bubbles + activity sequence + progress bar + Sun Drop counter
  - Sun Drop burst (reward) and Penalty burst (wrong answer) overlays
  - Lesson complete screen with star rating and gift unlock
**A5.** Build `PathView.tsx` â€” winding top-to-bottom trail
  - Lesson nodes with status (completed/current/locked)
  - Avatar on current node
  - Star ratings and health indicators on completed nodes
**A6.** Build basic `GardenWorld.tsx` â€” start with CSS/HTML version
  - Grid of tree plots
  - Simple avatar movement (arrow keys + D-pad)
  - Proximity detection for interaction panels
  - Can upgrade to PixiJS in Phase D
**A7.** Rewrite `App.tsx` navigation (Step 5)
**A8.** Build `AvatarPicker.tsx` + integrate into first-time flow

### Phase B: Growth & Decay

**B1.** Create `useGarden.tsx` hook â€” manages tree state
**B2.** Implement tree health decay (using `sunDropService.calculateTreeHealth`)
**B3.** Build floating health indicators in garden
**B4.** Create `lessonGenerator.ts` â€” AI structured lesson generation
**B5.** Create refresher lesson flow (shorter review lessons)
**B6.** Wire up Pocketbase: save/load trees, track Sun Drops

### Phase C: Social & Rewards

**C1.** Gift earn flow (lesson complete â†’ gift unlock)
**C2.** Gift send flow (pick friend â†’ send â†’ Pocketbase)
**C3.** Gift receive flow (notification â†’ apply to tree)
**C4.** Decoration system (earn items â†’ place in garden)
**C5.** Seed earning mechanics (path completion â†’ new seed)

### Phase D: Polish

**D1.** Upgrade garden to PixiJS (proper sprites, tilemaps, particles)
**D2.** Integrate Kenney.nl / CC0 sprite assets
**D3.** Add sound effects (optional)
**D4.** Mobile optimization (touch targets, D-pad, responsive)
**D5.** First-time tutorial flow
**D6.** Test with actual kids

---

## Step 8: Files to Deprecate

These files are replaced by the new system and should be removed or archived:

| File | Replaced by |
|------|------------|
| `components/ActivityWidget.tsx` | `components/lesson/activities/*` |
| `components/ChatInterface.tsx` | `components/lesson/LessonView.tsx` |
| `hooks/useMessageHandler.ts` | `hooks/useLesson.tsx` |
| XP-related code in `useAuth.tsx` | `hooks/useSunDrops.tsx` |
| Sidebar navigation in `App.tsx` | Tab bar + view switching |

**Do NOT delete these immediately.** Mark as `@deprecated` first, build the new system alongside, then remove once the new system is verified working.

---

## Step 9: Testing Checklist

### Activity testing (each of 6 types)
- [ ] Correct answer first try â†’ full Sun Drops + burst
- [ ] Wrong answer â†’ penalty burst + tree shake + -1
- [ ] Retry after wrong â†’ correct gives half
- [ ] Help button â†’ shows hint â†’ next correct gives half
- [ ] Multiple wrongs â†’ cumulative -1 each, floor of 0
- [ ] Can't go below 0 Sun Drops total in a lesson

### Lesson flow testing
- [ ] All activities complete â†’ lesson complete screen
- [ ] Star rating correct (1/2/3 based on %)
- [ ] Gift unlocked on completion
- [ ] Back button returns to path
- [ ] Replay resets all activity states

### Garden testing
- [ ] Avatar moves with arrow keys + WASD
- [ ] Avatar moves with mobile D-pad
- [ ] Proximity detection triggers interaction panel
- [ ] Correct panel shows for each tree state
- [ ] Empty plots show "Plant" option
- [ ] Health indicators update correctly

### Tree health testing
- [ ] Fresh tree = 100% health
- [ ] Health decays correctly over simulated days
- [ ] Gifts add buffer to decay
- [ ] Refresher lesson resets lastRefreshDate
- [ ] Visual stages match health percentages

---

## Key Reminders for Cline

1. **Read `GAME_DESIGN.md` before starting** â€” it's the source of truth for all game mechanics
2. **Use the prototype as UX reference** â€” `docs/prototypes/prototype-v4-final.jsx` shows exact behavior
3. **Sun Drops, not XP** â€” replace ALL references to XP throughout the codebase
4. **Garden is home** â€” there is no other home page or dashboard
5. **Every AI response must include an activity** â€” no standalone conversational messages during lessons
6. **Wrong answers = danger, not punishment** â€” dramatic feedback but always allow retry
7. **Trees decay** â€” this is the spaced repetition mechanic, it's non-negotiable
8. **Follow `.clinerules`** â€” especially confidence scoring, ask human when uncertain
9. **Phase A first** â€” get core mechanics working before social features
10. **Test with actual kids** â€” if it's not fun for a 10-year-old, it's not done
